# MEMSHADOW Production Configuration Template
# Copy to .env and fill in secure values
# NEVER commit .env file with actual secrets to version control!

# ============================================================================
# CRITICAL SECURITY SETTINGS - MUST CHANGE BEFORE DEPLOYMENT
# ============================================================================

# Web Interface Security (REQUIRED)
# Generate with: openssl rand -hex 32
WEB_SECRET_KEY="GENERATE_AND_REPLACE_THIS_32_CHAR_MINIMUM_SECRET_KEY"

# Admin Credentials (REQUIRED)
# Username: Choose a non-obvious username (not 'admin')
WEB_ADMIN_USERNAME="your_secure_admin_username"

# Password: Use a strong password and hash it with bcrypt
# Generate hash with: python -c "from passlib.hash import bcrypt; import getpass; print(bcrypt.hash(getpass.getpass('Password: ')))"
# Or set plain password here (will be hashed on startup, but less secure)
WEB_ADMIN_PASSWORD="your_secure_password_or_bcrypt_hash"

# CORS Origins (REQUIRED)
# Comma-separated list of allowed origins (NO WILDCARDS)
WEB_CORS_ORIGINS="https://yourdomain.com,https://app.yourdomain.com"

# Database Password (REQUIRED)
# Generate with: openssl rand -base64 32
POSTGRES_PASSWORD="GENERATE_AND_REPLACE_THIS_PASSWORD"

# Redis Password (REQUIRED)
# Generate with: openssl rand -base64 32
REDIS_PASSWORD="GENERATE_AND_REPLACE_THIS_PASSWORD"

# ============================================================================
# Application Settings
# ============================================================================

PROJECT_NAME="MEMSHADOW"
VERSION="1.0.0"
API_V1_STR="/api/v1"

# Web Interface
WEB_TOKEN_EXPIRY_HOURS=24

# Security Middleware
ENABLE_SECURITY_MIDDLEWARE=true

# ============================================================================
# Database Configuration
# ============================================================================

POSTGRES_SERVER=localhost
POSTGRES_USER=memshadow
POSTGRES_DB=memshadow
POSTGRES_PORT=5432

# Connection pool
POSTGRES_POOL_SIZE=20
POSTGRES_MAX_OVERFLOW=10

# ============================================================================
# Redis Configuration
# ============================================================================

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_URL="redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/${REDIS_DB}"

# Connection pool
REDIS_POOL_SIZE=50
REDIS_MAX_CONNECTIONS=100

# ============================================================================
# ChromaDB Configuration
# ============================================================================

CHROMA_HOST=localhost
CHROMA_PORT=8001
CHROMA_COLLECTION="memshadow_memories"
CHROMA_PERSIST_DIRECTORY="/var/lib/memshadow/chroma"

# ============================================================================
# Celery Configuration (Async Tasks)
# ============================================================================

CELERY_BROKER_URL="redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/1"
CELERY_RESULT_BACKEND="redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/1"
CELERY_TASK_ALWAYS_EAGER=false
CELERY_WORKER_CONCURRENCY=4

# ============================================================================
# Security Configuration
# ============================================================================

# JWT
ALGORITHM="HS256"

# Password Hashing
BCRYPT_ROUNDS=12

# MFA (Optional but recommended)
MFA_ENABLED=false
MFA_ISSUER="MEMSHADOW"
FIDO2_RP_ID="yourdomain.com"
FIDO2_RP_NAME="MEMSHADOW"

# ============================================================================
# Backup Configuration
# ============================================================================

SDAP_BACKUP_PATH="/var/backups/memshadow"
SDAP_ARCHIVE_SERVER="backup.yourdomain.internal"
SDAP_GPG_KEY_ID="your_gpg_key_id"
SDAP_RETENTION_DAYS=90

# ============================================================================
# Embedding Configuration
# ============================================================================

EMBEDDING_MODEL="sentence-transformers/all-mpnet-base-v2"
EMBEDDING_DIMENSION=768
EMBEDDING_CACHE_TTL=3600
EMBEDDING_BATCH_SIZE=32

# ============================================================================
# Logging Configuration
# ============================================================================

LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE="/var/log/memshadow/app.log"
LOG_MAX_BYTES=10485760  # 10MB
LOG_BACKUP_COUNT=10

# Security Audit Logging
AUDIT_LOG_ENABLED=true
AUDIT_LOG_FILE="/var/log/memshadow/audit.log"
AUDIT_LOG_RETENTION_DAYS=365

# ============================================================================
# Monitoring Configuration
# ============================================================================

# Prometheus
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090

# Metrics endpoint
METRICS_ENABLED=true
METRICS_PATH="/metrics"

# Health check
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH="/health"

# ============================================================================
# Performance Tuning
# ============================================================================

# Uvicorn workers (production)
UVICORN_WORKERS=4
UVICORN_HOST=127.0.0.1
UVICORN_PORT=8000

# Request limits
MAX_REQUEST_SIZE=10485760  # 10MB
REQUEST_TIMEOUT=60

# Rate limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_DEFAULT_RPM=60
RATE_LIMIT_BURST=10

# ============================================================================
# Feature Flags
# ============================================================================

# Phase 8 Features
ENABLE_FEDERATED_LEARNING=true
ENABLE_META_LEARNING=true
ENABLE_CONSCIOUSNESS=true
ENABLE_SELF_MODIFYING=false  # Disable by default for safety

# Self-Modifying Safety
SELF_MODIFYING_SAFETY_LEVEL="read_only"  # read_only, documentation, low_risk, medium_risk, full_access
SELF_MODIFYING_AUTO_APPLY=false
SELF_MODIFYING_REQUIRE_TESTS=true

# ============================================================================
# Development/Debug (NEVER enable in production!)
# ============================================================================

DEBUG=false
TESTING=false
RELOAD=false

# ============================================================================
# TLS/SSL (if not using reverse proxy)
# ============================================================================

USE_TLS=false  # Set true if running without reverse proxy (not recommended)
SSL_CERT_PATH="/path/to/cert.pem"
SSL_KEY_PATH="/path/to/key.pem"

# ============================================================================
# Optional: External Services
# ============================================================================

# Email notifications
EMAIL_ENABLED=false
EMAIL_HOST="smtp.gmail.com"
EMAIL_PORT=587
EMAIL_USERNAME=""
EMAIL_PASSWORD=""
EMAIL_FROM="noreply@yourdomain.com"

# Slack notifications
SLACK_ENABLED=false
SLACK_WEBHOOK_URL=""

# Sentry error tracking
SENTRY_ENABLED=false
SENTRY_DSN=""
SENTRY_ENVIRONMENT="production"

# ============================================================================
# Container/Cloud Configuration
# ============================================================================

# Docker
DOCKER_NETWORK="memshadow_network"

# Kubernetes
K8S_NAMESPACE="memshadow"
K8S_SERVICE_ACCOUNT="memshadow-sa"

# AWS (if using AWS services)
AWS_REGION="us-east-1"
AWS_ACCESS_KEY_ID=""
AWS_SECRET_ACCESS_KEY=""

# ============================================================================
# End of Configuration
# ============================================================================

# Notes:
# 1. Replace ALL "GENERATE_AND_REPLACE" values before deploying
# 2. Set WEB_ADMIN_PASSWORD to a bcrypt hash for best security
# 3. Keep this file secure (chmod 600)
# 4. NEVER commit .env to version control
# 5. Use environment-specific files (.env.production, .env.staging)
# 6. Rotate secrets regularly (quarterly recommended)
# 7. Enable MFA for admin accounts
# 8. Use a reverse proxy (nginx/caddy) with TLS
# 9. Enable all logging and monitoring in production
# 10. Test in staging environment first
